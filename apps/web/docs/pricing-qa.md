# اسکریپت QA — صفحه قیمت‌گذاری

## پیش‌نیاز
- دسترسی به محیط وب با داده‌های آزمایشی و امکان ورود کاربر.
- وجود حداقل یک پلن ماهانه و سالانه فعال در پایگاه داده.
- حساب کاربری با اشتراک فعال برای سناریوهای «کاربر دارای پلن».

## سناریوهای تست

1. **کاربر مهمان**
   - صفحه `/pricing` را در حالت خروج از حساب باز کنید.
   - بررسی کنید که صفحه در حالت RTL رندر شود و متن‌ها به فارسی باشند.
   - دکمه‌های خرید باید برچسب «شروع» داشته باشند و پیام کمکی «برای ادامه وارد شوید.» نمایش داده شود.
   - روی CTA کلیک کنید؛ باید به مسیر ورود با `callbackUrl` حاوی `cadence` و `plan` هدایت شوید.

2. **تغییر دوره پرداخت**
   - پس از ورود، بین «ماهانه» و «سالانه» جابه‌جا شوید.
   - تایید کنید قیمت تمام کارت‌ها تغییر کند، و پارامتر `cadence` در URL به‌روزرسانی شود.
   - صفحه را رفرش کنید و مطمئن شوید انتخاب دوره حفظ شده است.

3. **کاربر با اشتراک فعال همان پلن**
   - با کاربری که پلن فعال دارد وارد شوید.
   - کارت پلن متناظر باید نشان سبز «اشتراک فعال تا …» و دکمه «مدیریت اشتراک» داشته باشد.
   - دکمه «تمدید اکنون» را بزنید؛ باید checkout جدید ایجاد و مرورگر به درگاه هدایت شود (آدرس `/checkout/<id>` قبل از ریدایرکت کوتاه دیده می‌شود).

4. **کاربر با پلن متفاوت**
   - با کاربری که پلن متفاوتی دارد وارد شوید (مثلاً فعال ماهانه و کارت سالانه را مشاهده کنید).
   - CTA باید «ارتقا / تغییر پلن» باشد و متن سیاست «تغییر پلن از چرخه بعدی اعمال می‌شود.» نمایش داده شود.
   - روی CTA کلیک کنید؛ فرآیند checkout باید آغاز شود و توکن session ساخته شود.

5. **پیام لغو در پایان دوره**
   - برای کاربر فعال، مقدار `cancelAtPeriodEnd` را `true` کنید.
   - صفحه را رفرش کنید؛ بنر هشدار باید نمایش داده شود و لینک «لغو درخواست لغو» به `/dashboard/billing` هدایت کند.

6. **جدول مقایسه**
   - دکمه مقایسه را باز کنید (در دسکتاپ نمایش پیش‌فرض است).
   - بررسی کنید برای هر پلن ستون جداگانه و آیکون تیک/ضربدر برای ویژگی‌های بولی وجود داشته باشد.
   - با کیبورد (Tab/Shift+Tab) روی لینک‌ها و دکمه‌های بخش مقایسه پیمایش کنید و از فوکوس قابل مشاهده مطمئن شوید.

7. **خرید آگهی تکی**
   - کارت «خرید تکی» را بیابید و روی CTA کلیک کنید.
   - در صورت عدم ورود، باید به صفحه ورود هدایت شود؛ پس از ورود، checkout با قیمت یکباره شروع می‌شود.

8. **حالت خطا و بارگذاری**
   - درخواست `/pricing` را با قطع اتصال دیتابیس شبیه‌سازی کنید؛ باید پیام خطا و دکمه «تلاش مجدد» نمایش داده شود.
   - در حالت بارگذاری (network throttling)، اسکلت کارت‌ها و سوئیچ دوره مشاهده شود.

9. **تلِمتری کنسول**
   - کنسول مرورگر را باز کنید و بررسی کنید که رویدادهای `pricing_viewed`، `pricing_toggle_cadence` و `pricing_cta_clicked` با payload مناسب چاپ شوند (فاقد اطلاعات هویتی حساس).

## معیارهای قبولی
- تمام متن‌ها و اعداد با قالب فارسی و جلالی نمایش داده شوند.
- CTAها پس از شروع checkout غیرفعال شده و دوباره کلیک نشوند.
- مسیر بازگشت از checkout همان پارامترهای `plan` و `cadence` را حفظ کند.
- لینک‌های سیاست‌ها (`/help/faq`، `/legal/terms`، `/legal/refund`) بدون خطا لود شوند.
