{"code":"__filename=\"/Users/arminiranpour/Desktop/Project/CNaghsh-next/apps/web/lib/perf/slow-prisma-logger.ts\";(()=>{\n\"use strict\";var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var slow_prisma_logger_exports={};__export(slow_prisma_logger_exports,{initPrismaSlowLogger:()=>initPrismaSlowLogger});module.exports=__toCommonJS(slow_prisma_logger_exports);const instrumentedClients=new WeakSet;function initPrismaSlowLogger(prisma,options={}){if(instrumentedClients.has(prisma)){return}instrumentedClients.add(prisma);const thresholdMs=options.thresholdMs??200;const instrumentedPrisma=prisma;const handleQueryEvent=__name(event=>{const durationMs=typeof event.duration===\"number\"?event.duration:void 0;if(durationMs!==void 0&&durationMs>=thresholdMs){console.warn(\"[perf:db] slow_query\",{durationMs,query:event.query,params:event.params,target:event.target})}},\"handleQueryEvent\");try{instrumentedPrisma.$on(\"query\",handleQueryEvent)}catch(error){instrumentedPrisma.$use?.(async(params,next)=>{const startedAt=Date.now();const result=await next(params);const durationMs=Date.now()-startedAt;if(durationMs>=thresholdMs){console.warn(\"[perf:db] slow_query\",{durationMs,model:params.model,action:params.action})}return result});if(process.env.NODE_ENV!==\"test\"){console.info(\"[perf:db] slow_logger_fallback\",{reason:\"query event unavailable\",thresholdMs})}return}}__name(initPrismaSlowLogger,\"initPrismaSlowLogger\");0&&(module.exports={initPrismaSlowLogger});\n})()\n","warnings":[],"map":{"version":3,"mappings":";mvBAAA,+KAMA,MAAM,oBAAsB,IAAI,QAsBzB,SAAS,qBACd,OACA,QAA6B,CAAC,EACxB,CACN,GAAI,oBAAoB,IAAI,MAAM,EAAG,CACnC,MACF,CACA,oBAAoB,IAAI,MAAM,EAE9B,MAAM,YAAc,QAAQ,aAAe,IAC3C,MAAM,mBAAqB,OAE3B,MAAM,iBAAmB,OAAC,OAA4B,CACpD,MAAM,WAAa,OAAO,MAAM,WAAa,SAAW,MAAM,SAAW,OAEzE,GAAI,aAAe,QAAa,YAAc,YAAa,CACzD,QAAQ,KAAK,uBAAwB,CACnC,WACA,MAAO,MAAM,MACb,OAAQ,MAAM,OACd,OAAQ,MAAM,MAChB,CAAC,CACH,CACF,EAXyB,oBAazB,GAAI,CACF,mBAAmB,IAAI,QAAS,gBAAgB,CAClD,OAAS,MAAO,CAEd,mBAAmB,OAAO,MAAO,OAAQ,OAAS,CAChD,MAAM,UAAY,KAAK,IAAI,EAC3B,MAAM,OAAS,MAAM,KAAK,MAAM,EAChC,MAAM,WAAa,KAAK,IAAI,EAAI,UAChC,GAAI,YAAc,YAAa,CAC7B,QAAQ,KAAK,uBAAwB,CACnC,WACA,MAAO,OAAO,MACd,OAAQ,OAAO,MACjB,CAAC,CACH,CACA,OAAO,MACT,CAAC,EACD,GAAI,QAAQ,IAAI,WAAa,OAAQ,CACnC,QAAQ,KAAK,iCAAkC,CAC7C,OAAQ,0BACR,WACF,CAAC,CACH,CACA,MACF,CACF,CAlDgB","names":[],"ignoreList":[],"sources":["/Users/arminiranpour/Desktop/Project/CNaghsh-next/apps/web/lib/perf/slow-prisma-logger.ts"],"sourcesContent":[null]}}